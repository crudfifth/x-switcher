(()=>{"use strict";const e=document.querySelector("#account-table tbody"),t=document.getElementById("select-all"),c=document.getElementById("delete-selected-btn"),n=document.getElementById("export-data"),o=document.getElementById("import-data"),a=document.getElementById("import-file"),r=document.getElementById("edit-toggle");let d=[],s=!1;function l(){e.innerHTML="";for(const[t,c]of d.entries()){const n=document.createElement("tr");n.innerHTML=`\n      <td><input type="checkbox" class="account-checkbox" data-index="${t}" /></td>\n      <td>${c.name??c.twid}</td>\n      <td>${i(c.tag,t,"tag")}</td>\n      <td>${i(c.email,t,"email")}</td>\n      <td>${i(c.password,t,"password")}</td>\n      <td>${i(c.memo,t,"memo")}</td>\n    `,e.appendChild(n)}const t=document.querySelectorAll(".account-checkbox");for(const e of Array.from(t))e.addEventListener("change",u);m()}function i(e,t,c){return s?`<input type="text" data-index="${t}" data-field="${c}" value="${e??""}" />`:e??""}function u(){const e=document.querySelectorAll(".account-checkbox");let n=!1,o=!0;for(const t of Array.from(e))t.checked?n=!0:o=!1;c.disabled=!n,t.checked=o}function m(){const e=document.querySelectorAll(".account-checkbox");let t=!1;for(const c of Array.from(e))if(c.checked){t=!0;break}c.disabled=!t}document.addEventListener("DOMContentLoaded",(async()=>{const t=await chrome.storage.local.get(["accounts"]);d=t.accounts??[],l(),Sortable.create(e,{animation:150,handle:"tr",onEnd:()=>{!async function(){const t=[],c=Array.from(e.querySelectorAll("tr"));for(const e of c){const c=e.querySelector("input.account-checkbox")?.getAttribute("data-index"),n="string"==typeof c?Number.parseInt(c,10):Number.NaN;Number.isNaN(n)||t.push(d[n])}d=t,await chrome.storage.local.set({accounts:d}),l()}()}})})),t.addEventListener("change",(()=>{const e=document.querySelectorAll(".account-checkbox");for(const c of Array.from(e))c.checked=t.checked;m()})),c.addEventListener("click",(async()=>{const e=document.querySelectorAll(".account-checkbox:checked"),t=[];for(const c of Array.from(e)){const e=c.dataset.index,n="string"==typeof e?Number.parseInt(e,10):Number.NaN;Number.isNaN(n)||t.push(n)}d=d.filter(((e,c)=>!t.includes(c))),await chrome.storage.local.set({accounts:d}),l()})),n.addEventListener("click",(()=>{const e=new Blob([JSON.stringify(d,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),c=document.createElement("a");c.href=t,c.download="accounts.json",c.click(),URL.revokeObjectURL(t)})),o.addEventListener("click",(async()=>{const e=a.files?.[0];if(!e)return;const t=new FileReader;t.onload=async e=>{try{const t=e.target?.result;if("string"==typeof t){const e=JSON.parse(t);d=e,await chrome.storage.local.set({accounts:d}),l()}}catch(e){alert("インポートに失敗しました: 不正なJSONファイルです")}},t.readAsText(e)})),r.addEventListener("click",(async()=>{if(s){const e=document.querySelectorAll("td input[type='text']");for(const t of Array.from(e)){const e=Number.parseInt(t.dataset.index??"-1",10),c=t.dataset.field;"cookies"!==c&&d[e]&&c&&(d[e][c]=t.value)}await chrome.storage.local.set({accounts:d}),r.textContent="編集モードにする"}else r.textContent="保存する";s=!s,l()}))})();