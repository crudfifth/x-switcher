(()=>{"use strict";chrome.runtime.onMessage.addListener(((e,t,s)=>{if("fetch_username"===e.action){console.log("[DEBUG] Content Script: @username 取得リクエスト受信:",e.twid);const t=`https://x.com/i/user/${e.twid}`;console.log(`[DEBUG] Content Script: 取得 URL: ${t}`);try{return fetch(t).then((e=>(console.log(`[DEBUG] Content Script: Fetch Response Status: ${e.status}`),e.ok?e.text():(console.error(`[ERROR] Content Script: ユーザー取得失敗 (status=${e.status}): ${t}`),void s({success:!1,error:`fetch_failed_status_${e.status}`}))))).then((e=>{if(!e)return console.error("[ERROR] Content Script: レスポンスデータが空です。"),void s({success:!1,error:"empty_response"});console.log("[DEBUG] Content Script: Xから取得したデータ (先頭500文字):",e.slice(0,500));const t=/"screen_name":"(.*?)"/.exec(e);console.log("[DEBUG] Content Script: 正規表現マッチ結果:",t),t?(console.log(`[DEBUG] Content Script: 取得成功: @${t[1]}`),s({success:!0,username:`@${t[1]}`})):(console.warn("[WARN] Content Script: @username が見つかりませんでした。"),s({success:!1,error:"username_not_found"}))})).catch((e=>{const t=e;console.error("[ERROR] Content Script: Fetch 失敗:",t),s({success:!1,error:t.message})})),!0}catch(e){const t=e;return console.error("[ERROR] Content Script: 予期しないエラー:",t),s({success:!1,error:t.message}),!1}}}))})();